
exports.calcemi =function(req,res){
	var amt = req.query.txtamt;
	var years = req.query.txtyears;
	var ci = amt * Math.pow(1 + 0.10, years);
	var emi = ci / (years * 12);
	res.write("<h1>Emi calculation</h1>");
	res.write("<hr/>");
	res.write("<table cellpadding='10' bgcolor='#e3e3e3'>");
	res.write("<tr><td>name</td><td>" + req.query.txtname + "</td></tr>");
	res.write("<tr><td>Loan Amount</td><td>" + amt + "</td></tr>");
	res.write("<tr><td>Years</td><td>" + years + "</td></tr>");
	res.write("<tr><td>CI</td><td>" + ci + "</td></tr>");
	res.write("<tr><td>EMI</td><td>" + emi + "</td></tr>");
	res.write("</table>");
	 res.write('<a href="http://localhost:8081/index.html">home</a>');
	res.end();
}

exports.calctax =function(req, res){
	// Prepare output in JSON format
	var income = req.body.txtincome;
	var tax =0;
	if(income > 1000000)
		tax=(750000* 0.15)+ (income-1000000)*0.1;
	else if(income > 250000)
		tax = (income-250000)* 0.1;
   response = {
       name:req.body.txtname,
       aincome:req.body.txtincome,
       tax: tax
   };
   console.log(response);
   res.write('<a href="http://localhost:8081/index.html">home</a>');
   res.write("<hr/>");
   res.end(JSON.stringify(response));
}


exports.upload=function(req, res,fs){
	console.log('FIRST TEST: ' + JSON.stringify(req.file));
	console.log(req.file.originalname);
    console.log(req.file.path);
    console.log(req.file.mimetype);
    var response=null;
   var file =  req.file.originalname;
   fs.readFile( req.file.path, function (err, data) {
        fs.writeFile(file, data, function (err) {
         if( err ){
              console.log( err );
         }else{
               response = {
                   message:'File uploaded successfully',
                   filename:req.file.originalname
              };
          }
          console.log( response );
          res.write('<a href="http://localhost:8081/index.html">home</a>');
          res.end( JSON.stringify( response ) );
       });
   });
}

exports.viewemps= function(req,res,MongoClient){
	MongoClient.connect("mongodb://@127.0.0.1:27017/mydb", function(err, db) {
		if (!err) {
			console.log("We are connected");
			var c = db.collection('emps');
			res.write("<h1>Employee Details</h1>");
			res.write("<hr/>");
			c.find().toArray(function(err, items) {
				console.log(items.length);
				res.write("<table cellpadding='10' bgcolor='#e3e3e3'>");
				for (var i = 0; i < items.length; ++i) {
					console.log(items[i].pid + "  " + items[i].pname + " " + items[i].price + " " + items[i].cat);
				    res.write("<tr>");
				    res.write("<td>"+ items[i].emp_id +"</td>");
				    res.write("<td>"+ items[i].ename +"</td>");
				    
				    res.write("</tr>");
				}
				res.write("</table>");
				res.write('<a href="http://localhost:8081/index.html">home</a>');
				res.end();
			});
		}
	});
}


exports.viewempsjson=function(req,res,MongoClient){
	MongoClient.connect("mongodb://@127.0.0.1:27017/mydb", function(err, db) {
		if (!err) {
			console.log("We are connected");
			var c = db.collection('emps');
			c.find({},{"_id": 0}).toArray(function(err, items) {
				console.log(items.length);
				res.write('<a href="http://localhost:8081/index.html">home</a>');
				res.write("<hr/>");				
				res.write(JSON.stringify(items));
				
				res.end();
			});
		}
	});
}


